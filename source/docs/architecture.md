title: Architecture
date: 2016-04-08 17:43:24
---
## Application server

Сервер приложений UnityBase - **асинхронный** HTTP сервер со встроенным **синхронным** многопоточным интерпретатором JavaScript, ORM c поддержкой транзакционных промышленных СУБД (Oracle, SQL Server, PostgreSQL) и файловым хранилищем. Функциональность сервера расширяется модулями, написанными на JavaScript либо С/С++.
Внешний интерфейс сервера приложений полностью построен на REST API, что позволяет полнофункционально и бесшовно интерировать решение на основе UB с любым другим продуктом, поддерживающим протокол HTTP.

### Architecture
На диаграме ниже представлена обобщенная архитектура сервера UB: 

![](/images/ubServerArchitecture.png)

При запуске в многопоточном режиме сервер поднимает пул независимых между собой рабочих потоков (thread), каждый из которых содержит собственную копию интерпретатора JavaScript с загруженной бизнес-логикой и (при необходимости) - соединением с БД. 

При поступлении клиентского HTTP запроса он ставятся в очередь и передаётся первому освободившемуся рабочему потоку. Таким образом сервер UB из коробки представляет собой легковесную модель [FastCGI](https://ru.wikipedia.org/wiki/FastCGI) или [Node Cluster](https://nodejs.org/api/cluster.html).

В отличие от NodeJS JavaScript внутри рабочего потока UB _синхронен_, что драматически упрощает написание серверной бизнес логики. Необработанное исключение внутри потока прервет текущую задачу, поставит поток в режим ожидания новых запросов а текст исключения передаст в очередь HTTP ответов. В случае успешного выполнения результат так же ставится в очередь HTTP ответов.

Непосредственно прием/отправка HTTP выполняется в асинхронном неблокирующем режиме. 

### Scale
#### Vertical 
Вертикальное масштабирование - увеличение мощности сервера, осуществляется настройкой в конфигурационном файле количества рабочих потоков и длины очереди. При наличии достаточного количества ядер процессора не наблюдаеся деградации вплоть до 64х рабочих потоков. Длина очереди теоретически ограничена  размером ОЗУ. Таким образом при высокой нагрузке сервер UB способен эффективно (100%) использовать вычислительные мощности сервера вплоть до 64 ядерной конфигурации. 

Дополнительные материалы:
 - HTTP server configuration
 - Virtualization & HI Load

#### Горизонтальное
Горизонтальное масштабирование - увеличение количества серверов.

Если возможностей вертикального масштабирования недостаточно, что бывает крайне редко и в большинстве случаев свидетельствует о неоптимальном проектировании серверной бизнес логики, можно применить горизонтальное масштабирование. При этом перед пулом серверов приложений устанавливается и конфигурируется баллансировщик нагрузки. Особенностью UB при горизонтальном масштабировании является хранение каждым екземпляром сервера пользовательский сессий. Для предотвращеня повторных запросов на авторизацию баллансировщик должен обеспечивать попадание всех запросов с одного и того же IP-адреса на один и тот же сервер из пула. 


## Клиент
### adminUI
Веб приложение с поддержкой автогенерации/декларативного описания интерфейса пользователя, позволяющее создавать _интранет_ приложения неограниченного уровня сложности

Административный интерфейс (adminUI) - [Rich Internet application](https://en.wikipedia.org/wiki/Rich_Internet_application), предназначенное для создания десктоп-подобного интерфейса пользователя. Большинство интерфейсных элементов adminUI тесно интегрированны с моделью предметной области и являются автогенерируемыми. Таким образом достаточно описать на стороне сервера новую сущность системы (например, "Контрагент"), и adminUI автоматически обеспечивает основные операции с указанной сущностью:

 - просмотр списка, включая поиск, фильтрацию и.т.д.
 - форма для редактирования екземпляра
 - сложные ссылочные поля и отношения мастер/деталь
 - пользовательское меню 
 
 Административный интерфейс включает в себя встроенный построитель форм, позволяющий кастомизировать пользовательские формы произвольным образом

### portalUI
Уровень взаимодействия с сервером приложений  `adminUI` построен на базе библитотеки доступа `ub-core.js`  - наборе классов, облегчающий взаимодействие с сервером для браузерных клиентов.  Данная библиотека может быть использована в любом другом веб приложении, основанном на любом фреймворке, будь то Angular, React и.т.д. 
библиотек транспортного уровня - набор библиотек для основных языков програмирования, облегчающих работу с сервером приложений:

	- `ub-core.js` - для создания HTML5 SPA приложений c использованием любого клиентского фреймворка (`React`, `Angular`, `Vue`, и.т.д) 
    - библиотеки для `.Net`, `PHP`, `VBA (excel)`, `iOS`, `Android`.
