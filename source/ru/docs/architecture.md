title: Архитектура
date: 2016-04-08 17:43:24
---
## Сервер приложений

Сервер приложений UnityBase - **асинхронный** HTTP сервер со встроенным **синхронным** многопоточным интерпретатором JavaScript, ORM c поддержкой транзакционных промышленных СУБД (Oracle, SQL Server, PostgreSQL) и файловым хранилищем. Функциональность сервера расширяется модулями, написанными на JavaScript либо С/С++.
Внешний API сервера основан на HTTP протоколе, что позволяет полнофункционально и бесшовно интегрировать решение на основе UnityBase с любым другим продуктом, поддерживающим протокол HTTP.

### Архитектура
На диаграмме ниже представлена обобщенная архитектура сервера UnityBase: 

![](/images/ubServerArchitectureWS.png)

При запуске в многопоточном режиме сервер поднимает пул независимых между собой HTTP воркеров (thread), каждый из которых содержит собственную копию интерпретатора JavaScript с загруженной бизнес-логикой и при необходимости, соединением с БД. 

При поступлении клиентского HTTP запроса он ставятся в очередь, и передаётся первому освободившемуся рабочему потоку. Таким образом, сервер UnityBase  из коробки представляет собой легковесную модель [FastCGI](https://ru.wikipedia.org/wiki/FastCGI) или [Node Cluster](https://nodejs.org/api/cluster.html).

В отличие от NodeJS JavaScript внутри рабочего потока _синхронен_, что драматически упрощает написание серверной бизнес-логики. Необработанное исключение внутри потока прервет текущую задачу, поставит поток в режим ожидания новых запросов, а текст исключения передаст в очередь HTTP ответов. В случае успешного выполнения результат также ставится в очередь HTTP ответов.

Непосредственно прием/отправка HTTP выполняется в асинхронном неблокирующем режиме. 

### Масштабирование
#### Вертикальное 
Вертикальное масштабирование - увеличение мощности сервера, осуществляется настройкой в конфигурационном файле количества рабочих потоков и длины очереди. При наличии достаточного количества ядер процессора не наблюдается деградации вплоть до 64-х рабочих потоков. Длина очереди теоретически ограничена  размером ОЗУ. Таким образом, при высокой нагрузке сервер UnityBase способен эффективно (100%) использовать вычислительные мощности сервера вплоть до 64 ядерной конфигурации. 

Дополнительные материалы:
 - HTTP server configuration
 - Virtualization & HI Load

#### Горизонтальное
Горизонтальное масштабирование - увеличение количества серверов.

Если возможностей вертикального масштабирования недостаточно, что бывает крайне редко и в большинстве случаев свидетельствует о неоптимальном проектировании серверной бизнес логики, можно применить горизонтальное масштабирование. При этом перед пулом серверов приложений устанавливается и конфигурируется балансировщик нагрузки. Особенностью UnityBase при горизонтальном масштабировании является хранение каждым экземпляром сервера пользовательских сессий. Для предотвращения повторных запросов на авторизацию балансировщик должен обеспечивать попадание всех запросов с одного и того же IP-адреса на один и тот же сервер из пула. 


## Клиент
### adminUI
Веб приложение с поддержкой автогенерации/декларативного описания интерфейса пользователя, позволяющее создавать _интранет_ приложения неограниченного уровня сложности

Административный интерфейс (adminUI) - [Rich Internet application](https://en.wikipedia.org/wiki/Rich_Internet_application), предназначенное для создания десктоп-подобного интерфейса пользователя. Большинство интерфейсных элементов adminUI тесно интегрированы с моделью предметной области и являются автогенерируемыми. Таким образом, достаточно описать на стороне сервера новую сущность системы (например, "Контрагент") и adminUI автоматически обеспечивает основные операции с указанной сущностью:

 - просмотр списка, включая поиск, фильтрацию и т.д.
 - форма для редактирования экземпляра
 - сложные ссылочные поля и отношения мастер/деталь
 - пользовательское меню 
 
 Административный интерфейс включает в себя встроенный построитель форм, позволяющий кастомизировать пользовательские формы произвольным образом

### portalUI
Уровень взаимодействия с сервером приложений  `adminUI` построен на базе библиотеки доступа `ub-core.js`  - наборе классов, облегчающий взаимодействие с сервером для браузерных клиентов.  Данная библиотека может быть использована в любом другом веб-приложении, основанном на любом фреймворке (Angular, React и т.п.). 
Дополнительно предоставляются клиентские библиотеки для `.Net`, `PHP`, `VBA (excel)`, `iOS`, `Android`.